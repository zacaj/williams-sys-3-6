0001   0000             displayStrobe: 	.equ $2800
0002   0000             displayBcd: 	.equ $2802
0003   0000             displayStrobeC:	.equ $2801
0004   0000             displayBcdC:	.equ $2803
0005   0000             lampRow:		.equ $2400
0006   0000             lampRowC:		.equ $2401
0007   0000             lampStrobe:		.equ $2402
0008   0000             lampStrobeC:	.equ $2403
0009   0000             switchStrobe:	.equ $3002
0010   0000             switchStrobeC:	.equ $3003
0011   0000             switchRow:		.equ $3000
0012   0000             switchRowC:		.equ $3001
0013   0000             
0014   0000             RAM:			.equ $0000
0015   0000             cRAM:			.equ $0100
0016   0000             displayColumn:			.equ RAM + $00
0017   0000             counter:		.equ RAM + $01
0018   0000             temp:			.equ RAM + $02
0019   0000             counter2:		.equ RAM + $03
0020   0000             strobe:		.equ RAM + $07
0021   0000             lampRow1:		.equ RAM + $08
0022   0000             
0023   0000             displayBcd1:	.equ RAM + $10
0024   0000             
0025   0000             switchRow1:		.equ RAM + $1F
0026   0000             
0027   7800             main:		.org $7800
0028   7800             	
0029   7800             piaSetup:
0030   7800 86 00       	ldaA	#00000000b	;select direction (3rd bit = 0)
0031   7802 B7 28 01    	staA 	displayStrobeC
0032   7805 86 3F       	ldaA 	#00111111b	;set LED pins to outputs
0033   7807 B7 28 00    	staA 	displayStrobe
0034   780A 86 04       	ldaA 	#00000100b 	;select data (3rb bit = 1)
0035   780C B7 28 01    	staA 	displayStrobeC
0036   780F             	
0037   780F 86 00       	ldaA	#00000000b	;select direction (3rd bit = 0)
0038   7811 B7 28 03    	staA 	displayBcdC
0039   7814 86 FF       	ldaA 	#11111111b	;set display BCD to output
0040   7816 B7 28 02    	staA 	displayBcd
0041   7819 86 04       	ldaA 	#00000100b 	;select data (3rb bit = 1)
0042   781B B7 28 03    	staA 	displayBcdC
0043   781E             	
0044   781E 86 00       	ldaA	#00000000b	;select direction (3rd bit = 0)
0045   7820 B7 24 01    	staA 	lampRowC
0046   7823 86 FF       	ldaA 	#11111111b	;set to output
0047   7825 B7 24 00    	staA 	lampRow
0048   7828 86 04       	ldaA 	#00000100b 	;select data (3rb bit = 1)
0049   782A B7 24 01    	staA 	lampRowC
0050   782D             	
0051   782D 86 00       	ldaA	#00000000b	;select direction (3rd bit = 0)
0052   782F B7 24 03    	staA 	lampStrobeC
0053   7832 86 FF       	ldaA 	#11111111b	;set to output
0054   7834 B7 24 02    	staA 	lampStrobe
0055   7837 86 04       	ldaA 	#00000100b 	;select data (3rb bit = 1)
0056   7839 B7 24 03    	staA 	lampStrobeC
0057   783C             	
0058   783C 86 00       	ldaA	#00000000b	;select direction (3rd bit = 0)
0059   783E B7 30 03    	staA 	switchStrobeC
0060   7841 86 FF       	ldaA 	#11111111b	;set to output
0061   7843 B7 30 02    	staA 	switchStrobe
0062   7846 86 04       	ldaA 	#00000100b 	;select data (3rb bit = 1)
0063   7848 B7 30 03    	staA 	switchStrobeC
0064   784B             	
0065   784B 86 00       	ldaA	#00000000b	;select direction (3rd bit = 0)
0066   784D B7 30 01    	staA 	switchRowC
0067   7850 86 00       	ldaA 	#00000000b	;set to input
0068   7852 B7 30 00    	staA 	switchRow
0069   7855 86 04       	ldaA 	#00000100b 	;select data (3rb bit = 1)
0070   7857 B7 30 01    	staA 	switchRowC
0071   785A             	
0072   785A 86 00       	ldaA	#00
0073   785C D7 10       	staB	displayBcd1
0074   785E             	
0075   785E 86 FF       	ldaA	#$FF	
0076   7860 B7 28 00    	staA 	displayStrobe
0077   7863             
0078   7863 86 00       	ldaA	#00
0079   7865 97 07       	staA	strobe
0080   7867             	
0081   7867 86 F0       	ldaA	#$F0
0082   7869 97 08       	staA	lampRow1
0083   786B             	
0084   786B             loop:
0085   786B 7C 00 01    	inc		counter
0086   786E 86 00       	ldaA	#0
0087   7870 91 01       	cmpA	counter
0088   7872 26 1F       	bne		counterHandled
0089   7874 7C 00 03    	inc 	counter2
0090   7877 91 03       	cmpA	counter2
0091   7879 26 18       	bne		counterHandled
0092   787B             	
0093   787B 86 F0       	ldaA	#$F0
0094   787D 91 08       	cmpA	lampRow1
0095   787F 27 0A       	beq		on
0096   7881             	
0097   7881 86 F0       	ldaA	#$F0
0098   7883 97 08       	staA	lampRow1
0099   7885 86 77       	ldaA	#01110111b
0100   7887 97 10       	staA	displayBcd1	
0101   7889 20 08       	bra		counterHandled
0102   788B             on:
0103   788B 86 0F       	ldaA	#$0F
0104   788D 97 08       	staA	lampRow1
0105   788F 86 33       	ldaA	#00110011b
0106   7891 97 10       	staA	displayBcd1	
0107   7893             
0108   7893             counterHandled:
0109   7893             ; move switch column
0110   7893 96 07       	ldaA	strobe
0111   7895 B7 30 02    	staA	switchStrobe
0112   7898             	
0113   7898             ; update display 
0114   7898 86 F0       	ldaA	#11110000b	
0115   789A 9A 00       	oraA	displayColumn	
0116   789C C6 FF       	ldaB 	#$FF
0117   789E F7 28 02    	staB	displayBcd
0118   78A1 B7 28 00    	staA	displayStrobe
0119   78A4 D6 10       	ldaB	displayBcd1
0120   78A6 F7 28 02    	staB	displayBcd
0121   78A9 7C 00 00    	inc 	displayColumn
0122   78AC             	
0123   78AC             ; read switches
0124   78AC B6 30 00    	ldaA	switchRow
0125   78AF 43          	comA
0126   78B0 97 08       	staA	lampRow1 ; for debugging
0127   78B2 97 1F       	staA 	switchRow1
0128   78B4             	
0129   78B4             ; update lamps
0130   78B4 86 FF       	ldaA	#$FF
0131   78B6 B7 24 00    	staA	lampRow
0132   78B9 96 07       	ldaA	strobe
0133   78BB B7 24 02    	staA	lampStrobe
0134   78BE 96 08       	ldaA	lampRow1
0135   78C0 B7 24 00    	staA	lampRow
0136   78C3 86 00       	ldaA	#00
0137   78C5             
0138   78C5             	
0139   78C5 78 00 07    	asl		strobe
0140   78C8 91 07       	cmpA	strobe ; strobe done?  reset
0141   78CA 26 04       	bne		sNotZero
0142   78CC 86 01       		ldaA	#00000001b
0143   78CE 97 07       		staA	strobe
0144   78D0             sNotZero:
0145   78D0 20 99       		bra		loop
0146   78D2             	
0147   78D2             end:
0148   78D2 20 FE       	bra		end
0149   78D4             	
0150   78D4             interrupt:	
0151   78D4 3B          	rti
0152   78D5             
0153   78D5             
0154   7FF8             pointers: 	.org $7FF8  	; is this right?
0155   7FF8             	.msfirst
0156   7FF8 78 D4       	.dw interrupt			
0157   7FFA 78 D4       	.dw interrupt			
0158   7FFC 78 D4       	.dw interrupt			
0159   7FFE 78 00       	.dw main
0160   8000             	
0161   8000             	
0162   8000             	.endtasm: Number of errors = 0
